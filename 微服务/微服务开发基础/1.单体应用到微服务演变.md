# 单体应用

## 1.单体应用痛点

1. 代码大量重复, 不能复用
2. 系统间不能相互调用
3. 接口不仅要对外提供服务, 还要对内提供接口
4. 数据分析功能导致数据库性能问题影响业务
5. 数据库被多个业务员系统依赖, 无法拆分和升级
6. 以表作为中介进行通信
7. 接口写的不好导致数据库性能下降
8. 开发测试, 依赖严重, 部署困难
9. 各业务系统依赖严重, 上线发布困难

![image-20211101003645510](https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20211101003645510.png)

## 2.单体应用痛点解决

1. 代码大量重复, 不能复用

   - 代码模块化

   - 服务模块化

     > 还是存在问题: 数据库瓶颈问题.多个系统依赖同一个数据库, 数据库表结构修改影响较大

     <img src="https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20211101004538218.png" alt="image-20211101004538218" style="zoom:33%;" />

2. 系统间不能相互调用

3. 接口不仅要对外提供服务, 还要对内提供接口

4. 数据分析功能导致数据库性能问题影响业务

5. 数据库被多个业务员系统依赖, 无法拆分和升级

6. 以表作为中介进行通行

7. 接口写的不好导致数据库性能下降

8. 开发测试, 依赖严重, 部署困难

9. 各业务系统依赖严重, 上线发布困难

# 微服务架构

## 1. 简单微服务架构



<img src="https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20211101005434642.png" alt="image-20211101005434642" style="zoom:50%;" />

- 存在问题
  - 单个服务需要向前端提供http接口, 也要向内部提供rpc接口

## 2. 分层的微服务结构设计

- web服务对前端提供http服务
- srv服务(rpc服务)对内部提供rpc服务
- web层可以调用srv层, srv层的服务之间可以互相调用, srv不能调用web服务(下层不能调用上层)
- 只有srv层服务接触数据库

<img src="https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20211101010446774.png" alt="image-20211101010446774" style="zoom:50%;" />

> 分层微服务存在问题:
>
> 1. 需要记住各个srv服务之间的ip和端口号
> 2. 需要掌握各个srv服务的健康状态
>
> 解决办法:
>
> - 通过注册中心集中管理微服务

## 3. 微服务最终结构

- 服务网关作用: 
  - 路由管理
  - 服务发现
  - 鉴权
  - 熔断
  - 黑白名单
  - 负载均衡等
- 注册中心: 管理多个服务, 注册服务的ip和端口号
- 服务发现: 管理多个服务的健康状态
- 配置中心: 统一管理配置文件, 例如短信的key和秘钥等等
- 链路追踪: 查看请求链路, 方便排查问题, 类似单体服务log

![微服务结构](https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%BB%93%E6%9E%84.png)



# 微服务概念

- 围绕业务功能构建的，服务关注单一业务，服务间采用轻量级的通信机制，可以全自动独立部署，可以使用不同的编程语言和数据存储技术。微服务架构通过业务拆分实现服务组件化，通过组件组合快速开发系统，业务单一的服务组件又可以独立部署，使得整个系统变得清晰灵活：
  - 原子服务
  - 独立进程
  - 隔离部署
  - 去中心化服务治理
- 缺点：
  - 基础设施的建设、复杂度高